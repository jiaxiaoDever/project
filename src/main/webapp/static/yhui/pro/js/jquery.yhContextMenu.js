/*!
* yhui 1.3.0beta
* jquery.yhContextMenu.js
* 2013-04-23
*/
(function(e){var t=0,i=0;e.widget("yhui.yhContextMenu",{version:"1.3.0beta",options:{eventNamespace:"",menu:null,width:150,zIndex:200,beforeShow:null,createdMenu:null,show:null,beforeHide:null,hide:null},_create:function(){this.menuId="yhui-menu-"+i++,this.element.attr("hascontextmenu",this.menuId),this._context()},_parse:function(){var t=this.options.menu;return t?(this.windowSize={width:e(window).width(),height:e(window).height()},e.isPlainObject(t)&&(this._createMenu(t),this._events()),void 0):e.yhui.log("menu属性不是有效值")},_createMenu:function(i){var s=e(),n=this;this.funCache={},e.each(i,function(i,a){var o=t++;n.funCache[o]=a,s=s.add(e("<li><a data-funid = "+o+" href = '#'>"+i+"</a></li>"))}),this.menu=e("<ul></ul>").attr("id",this.menuId).width(this.options.width).addClass("yhui-contextmenu").append(s).appendTo(document.body).menu().hide(),this._trigger("createdMenu",null,this._getEventParam())},_context:function(){var e=this,t=this.options.eventNamespace?"."+this.options.eventNamespace:this.eventNamespace;this.element.on("contextmenu"+t,function(t){return e.eventObj=t,e.menu||e._parse(),e._showMenu(t),!1})},_events:function(){var t=this,i=this.options.eventNamespace?"."+this.options.eventNamespace:this.eventNamespace;this.document.on("click"+i+" contextmenu"+i,function(){t.hideMenu()}).on("keydown"+i,function(i){i.keyCode===e.ui.keyCode.ESCAPE&&t.hideMenu()}),this.menu.on("click"+i,"a",function(e){e.preventDefault();var i=t.funCache[this.getAttribute("data-funid")];i&&"function"==typeof i&&i.call(this,e,t.eventObj.target,t.element)}),this.window.on("resize"+i,function(){t.hideMenu(),t.windowSize={width:e(window).width(),height:e(window).height()}})},_showMenu:function(e){var t=this,i=this._calPosition(e.pageX,e.pageY),s=t.options.zIndex;this._trigger("beforeShow",null,this._getEventParam())!==!1&&(s&&200>s&&(s=200),this.menu.css({position:"absolute",zIndex:s,top:i.top+"px",left:i.left+"px"}).show(),this._trigger("show",null,this._getEventParam()))},_calPosition:function(e,t){var i,s,n={},a=this.menu.width(),o=this.menu.height();return n.left=(i=e+a-this.windowSize.width)>0?e-i-6:e,n.top=(s=t+o-this.windowSize.height)>0?t-s-6:t,n},hideMenu:function(){this.menu.is(":visible")&&this._trigger("beforeHide",null,this._getEventParam())!==!1&&(this.menu.hide().css({top:"-1000px",left:"-1000px"}),this._trigger("hide",null,this._getEventParam()))},_getEventParam:function(){return{target:this.eventObj.target,menu:this.menu,container:this.element}},_disableItem:function(e){this.menu.find("a").eq(e).addClass("ui-state-disabled").on("click.disable mouseenter.disable mouseleave.disable",function(){return!1})},_enableItem:function(e){this.menu.find("a").eq(e).removeClass("ui-state-disabled").off(".disable")},disableItem:function(e){if("number"==typeof e)this._disableItem(e);else for(var t=0,i=e.length;i>t;t++)this._disableItem(e[t])},enableItem:function(e){if("number"==typeof e)this._enableItem(e);else for(var t=0,i=e.length;i>t;t++)this._enableItem(e[t])},isItemDisable:function(e){return this.menu.find("a").eq(e).hasClass("ui-state-disabled")}})})(jQuery);