/*!
* yhui 1.3.0beta
* jquery.yhGrid.js
* 2013-04-23
*/
(function(t){if(!t.fn.jqGrid)return t.yhui.log("没有找到 jqGrid 插件!");var e=function(t,e){this.element=t,this.options=e};t.extend(e.prototype,{version:"1.3.0beta",init:function(){var t=this.options;return t.datatype||(t.datatype="json"),"fill"===t.heightStyle&&t.autowidth&&(t.autowidth=!1),t.treeGrid&&(t.treeIcons={plus:"ui-icon-plus",minus:"ui-icon-minus",leaf:"ui-icon-document"},t.ExpandColClick=!0),this.parent=this.element.parent(),this.grid=this.element.jqGrid(t),"fill"===t.heightStyle&&this.refresh(),t.contextmenu&&this._contextmenu(),this.grid},refresh:function(){this._setHeight(),this._setWidth()},_setHeight:function(){var e=this.grid.closest("div.ui-jqgrid-bdiv").siblings().not(".frozen-div, .frozen-bdiv"),i=this.parent.height(),s=0;this.grid.closest("div.ui-jqgrid").children().not(".ui-jqgrid-view,.loading").add(e).each(function(){t(this).is(":visible")&&(s+=t(this).outerHeight())}),this.grid.jqGrid("setGridHeight",i-s-2)},_setWidth:function(){this.grid.jqGrid("setGridWidth",this.parent.width()-2)},_contextmenu:function(){for(var e={},i={},s=0,a=this,n="",o=this.options.colName||[],r=this.options.colModel,h=r.length;h>s;s++){var l=o[s]||r[s].label,d="yhui-grid-ctxitem-"+s;e[l]=r[s].name,n="<input id='"+d+"' type='checkbox' checked/><label for='"+d+"' style = 'position:relative; cursor: pointer; top:-2px; margin-left:5px;'>"+l+"</label>",i[n]=function(){var t=this.firstChild;a._contextCheck(t.checked,t,e[this.lastChild.innerHTML])}}t("#gbox_"+this.grid.attr("id")).yhContextMenu({menu:i,createdMenu:function(t,i){i.menu.on("click",":checkbox",function(t){t.stopPropagation(),a._contextCheck(!this.checked,this,e[this.nextSibling.innerHTML])})}})},_contextCheck:function(t,e,i){t?(e.checked=!1,this.grid.yhGrid("hideCol",i)):(e.checked=!0,this.grid.yhGrid("showCol",i)),this.refresh()}}),t.extend(t.fn,{yhGrid:function(i){if("string"==typeof i){var s=t.data(this[0],"yhGrid");if(0!==i.indexOf("_")&&t.isFunction(s[i]))return s[i].apply(s,arguments),this;var a=this.jqGrid.apply(this,arguments);return"filterToolbar"===i||"setGroupHeaders"===i?(s.refresh(),this):a}var n=new e(this,i);return t.data(this[0],"yhGrid",n),n.init()}})})(jQuery);