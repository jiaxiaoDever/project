/*!
* yhui 1.3.0beta
* jquery.yhWindow.js
* 2013-04-23
*/
(function(i){var t=!0,e=null,a=null,s=!0,o={},n={id:{LI:"yhwindow-taskbarlist-"},className:{SARROW:"ui-icon-triangle-1-s",NARROW:"ui-icon-triangle-1-n",MAXI:"ui-icon-newwin",RESTORE:"ui-icon-yhmaxi"}};i.widget("yhui.yhWindow",i.ui.dialog,{version:"1.3.0beta",options:{maxi:!0,mini:!0,fold:!0,showTaskBar:!0,dragHelper:!0,beforeMaxi:null,beforeMini:null},_create:function(){this._super(),this._parse(),this._events()},_parse:function(){this.options.showTaskBar&&t&&this._createBottomUl(),this.options.maxi&&(this.maxi=i("<a class = 'ui-dialog-titlebar-maxi ui-corner-all' href='#' role = 'maxi'><span class = 'ui-icon ui-icon-yhmaxi'>maxi</span></a>").appendTo(this.uiDialogTitlebar)),this.options.showTaskBar&&this.options.mini&&(this.mini=i("<a class = 'ui-dialog-titlebar-mini ui-corner-all' href='#' role = 'mini'><span class = 'ui-icon ui-icon-minusthick'>mini</span></a>").appendTo(this.uiDialogTitlebar)),this.options.fold&&(this.fold=i("<a class = 'ui-dialog-titlebar-fold ui-corner-all' href='#' role = 'fold'><span class = 'ui-icon ui-icon-triangle-1-n'>fold</span></a>").appendTo(this.uiDialogTitlebar))},_createBottomUl:function(){(e=i("<div class = 'yhui-window-taskbar'><div id = 'yhWindowTaskBarWrap' class = 'yhui-window-taskbar-inner'></div></div>")).appendTo(this.document[0].body),(a=i("<ul id = 'yhWindowTaskBar' ></ul>")).appendTo(i("#yhWindowTaskBarWrap"))},_events:function(){var e=this;this._hoverable(this.fold),this._hoverable(this.maxi),this._hoverable(this.mini),this._recordSizeInfo(),this.uiDialogTitlebar.on("click"+this.eventNamespace,"a",function(t){if(!(this.className.indexOf("ui-dialog-titlebar-close")>-1))switch(t.preventDefault(),this.getAttribute("role")){case"fold":i(this).children("span").toggleClass(n.className.SARROW+" "+n.className.NARROW),e.maxi&&e.maxi.toggle(),e.titleBarHeight!==e.uiDialog.height()?e.uiDialog.animate({height:e.titleBarHeight}):e.uiDialog.animate({height:e.sizeInfo.height});break;case"mini":e._trigger("beforeMini",null,e._getParam()),e.uiDialog.hide("transfer",{to:i("#"+n.id.LI+e.uuid)},function(){i(this).fadeOut(100)});break;case"maxi":i(this).children("span").toggleClass(n.className.MAXI+" "+n.className.RESTORE),e.fold&&e.fold.toggle(),e.isMaxi?e._restore():e._maxi()}}),this.window.on("resize"+e.eventNamespace,function(){e.isMaxi&&setTimeout(function(){e._maxi()},20)}),this.options.showTaskBar&&t&&(a.on("click"+e.eventNamespace,function(i){var t=i.target.nodeName.toLowerCase();if("ul"!==t&&("li"===t&&(o[i.target.id].uiDialog.fadeIn(100),o[i.target.id].moveToTop(!0)),"span"===t)){var e=i.target.parentNode.id;o[e].close()}}),this._contextMenu(),t=!1)},_restore:function(){this.uiDialog.offset({top:this.sizeInfo.top,left:this.sizeInfo.left}),this.uiDialog.width(this.sizeInfo.width),this.element.height(this.sizeInfo.height-this.titleBarHeight),this.isMaxi=!1},_maxi:function(){this._trigger("beforeMaxi",null,this._getParam()),this.uiDialog.offset({top:0,left:0}).width(i(window).width()-2).css("height","auto"),this.element.height(i(window).height()-(e?e.outerHeight():0)-this.titleBarHeight),this.isMaxi=!0},_contextMenu:function(){var t=this,s={"关闭当前":function(i,e){var a=t._getTaskItemId(e);o[a].close()},"关闭其他":function(i,e){var a=t._getTaskItemId(e);for(var s in o)s!==a&&o[s].close()},"关闭全部":function(){for(var i in o)o[i].close();e.slideUp()}};a.yhContextMenu({menu:s,width:100,zIndex:2001,eventNamespace:"yhWindow",beforeShow:function(t,e){var a=i(e.target.parentNode).find("li").length;return"ul"===e.target.nodeName.toLowerCase()?!1:(1===a?i(this).yhContextMenu("disableItem",1):i(this).yhContextMenu("isItemDisable",1)&&i(this).yhContextMenu("enableItem",1),void 0)}})},_getTaskItemId:function(i){return"span"===i.nodeName.toLowerCase()?i.parentNode.id:i.id},_getParam:function(){return{window:this,taskBar:e?e:null}},open:function(){if(this._super(),this.options.showTaskBar){var t;(s||0===a.children("li").length)&&e.slideDown(),t=i("<li></li>").text(this.originalTitle).attr({title:this.originalTitle,id:n.id.LI+this.uuid}).hide().appendTo(a).delay(100).show(200),i("<span title = '关闭'></span>").appendTo(t),s=!1,o[n.id.LI+this.uuid]=this}this.sizeInfo={left:this.uiDialog.offset().left,top:this.uiDialog.offset().top,width:this.uiDialog.outerWidth(),height:this.uiDialog.outerHeight()},this.titleBarHeight=this.uiDialogTitlebar.outerHeight()},close:function(){this._super(),this.options.showTaskBar&&(1!==a.children("li").length?i("#"+n.id.LI+this.uuid).hide(300,function(){i(this).remove()}):i("#"+n.id.LI+this.uuid).hide(300,function(){i(this).remove(),e.slideUp()}))},_recordSizeInfo:function(){var t=this;this.uiDialog.on("resizestop"+this.eventNamespace,function(){var e=i(this);t._delay(function(){t.sizeInfo.width=e.outerWidth(),t.sizeInfo.height=e.outerHeight()},20)}),this.uiDialog.on("dragstop"+this.eventNamespace,function(){var e=i(this);t._delay(function(){var i=e.offset();t.sizeInfo.top=i.top,t.sizeInfo.left=i.left},20)})},destroy:function(){this.window.off(this.eventNamespace),this.uiDialog.off(this.eventNamespace),this.uiDialogTitlebar.off(this.eventNamespace),this._super()}})})(jQuery);