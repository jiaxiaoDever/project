/*!
* yhui 1.3.0beta
* jquery.yhSwitchPanel.js
* 2013-04-23
*/
(function(t){var e=0;t.widget("yhui.yhSwitchPanel",{version:"1.3.0beta",options:{active:0,header:">:even",duration:"fast",showAllIcons:!0,icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},iconsAll:{activateAll:"ui-icon-plus",foldAll:"ui-icon-minus"},fold:null,beforeFold:null,activate:null,beforeActivate:null,load:null,iframeLoaded:null,beforeAppend:null},version:"1.2",_consts:{CLASS:{CONTAINER:"ui-accordion ui-widget ui-helper-reset yhui-switchpanel",HEADER:"ui-accordion-header ui-helper-reset ui-state-default ui-corner-all",PANEL:"ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom noPadding yhui-switchpanel-panel",ACTIVE:{HEADER:"ui-accordion-header-active ui-state-active",PANEL:"ui-accordion-content-active"},CORNER:"ui-corner-all ui-corner-top"}},_create:function(){this._initDom(),this._events(),"false"===this.headers.last().attr("aria-actived")&&this._fixBottomBorder(!0)},_initDom:function(){var i=this.options,a="yhui-yhSwitchPanle-"+(this.element.attr("id")||++e),s=this;this.element.addClass(this._consts.CLASS.CONTAINER),this.headers=this.element.find(i.header).addClass(this._consts.CLASS.HEADER).disableSelection(),this.panles=this.headers.next().addClass(this._consts.CLASS.PANEL).css("borderBottom","none").hide(),null!==i.active&&(this.actives=this._findActive(i.active).addClass(this._consts.CLASS.ACTIVE.HEADER).toggleClass(this._consts.CLASS.CORNER),this.actives.each(function(){var e;(e=this.getAttribute("data-type"))?s._checkContentType(t(this).next(),e):t(this).next().addClass(s._consts.CLASS.ACTIVE.PANEL).show()})),this.headers.attr("role","tab").each(function(e){var i=t(this),s=i.attr("id"),n=i.next(),o=n.attr("id");s||(s=a+"-header-"+e,i.attr("id",s)),o||(o=a+"-panel-"+e,n.attr("id",o)),i.attr("aria-controls",o),n.attr("aria-labelledby",s)}).next().attr("role","tabpanel"),this.headers.not(this.actives).attr("aria-actived",!1).next().attr("aria-hidden",!0).hide(),this.actives.attr("aria-actived",!0).next().attr("aria-hidden",!1),this._createIcons(),this.options.showAllIcons&&this._createAllIcons()},_getCreateEventData:function(){return{header:this.actives,panel:this.actives.length?this.actives.next():t()}},_createIcons:function(){var e=this.options.icons;e&&(t("<span>").addClass("ui-accordion-header-icon ui-icon "+e.header).prependTo(this.headers),this.actives.children(".ui-accordion-header-icon").removeClass(e.header).addClass(e.activeHeader),this.headers.addClass("ui-accordion-icons"))},_createAllIcons:function(){var e={activateAll:"打开全部面部",foldAll:"折叠全部面板"},i=this.options.iconsAll,a=this;t.each(e,function(e,s){a[e+"Icon"]=t("<span>").addClass("yhui-switchpanel-"+e.toLowerCase()+" ui-icon "+i[e]).attr("title",s).appendTo(a.headers.first()).tooltip()})},_findActive:function(e){var i=t(),a=this;return"number"==typeof e?i=i.add(this.headers.eq(e)):t.each(e,function(t,e){i=i.add(a.headers.eq(e))}),i},_events:function(){var e=this;this._hoverable(this.headers),this.headers.on("click"+this.eventNamespace,function(){"false"===this.getAttribute("aria-actived")?e._activate(t(this),e._isLastHeader(this)):e._fold(t(this),e._isLastHeader(this))}).find("a").on("click"+this.eventNamespace,function(t){t.preventDefault()}),this.activateAllIcon&&this.activateAllIcon.on("click"+this.eventNamespace,function(){return t(this).tooltip("close"),e.activateAll(),!1}),this.foldAllIcon&&this.foldAllIcon.on("click"+this.eventNamespace,function(){return t(this).tooltip("close"),e.foldAll(),!1})},_getEventDate:function(e){return{header:t(e),panel:t(e).next(),obj:this}},_activate:function(e,i,a){var s=this,n=function(){var i=e.next().find("iframe");i.length&&a&&t.isFunction(a)&&a.apply(i[0],arguments)};if("true"===e.attr("aria-load")&&"true"===e.attr("aria-actived"))return n(),void 0;if(e.jquery){if(s._trigger("beforeActivate",null,s._getEventDate(e))===!1)return;s._isLastHeader(e[0])&&s._fixBottomBorder(!0),s._toggerIcons(t(e)),e.addClass(s._consts.CLASS.ACTIVE.HEADER).toggleClass(s._consts.CLASS.CORNER+(i?" bottomBorder":"")).attr("aria-actived",!0).next().attr("aria-hidden",!1).slideDown(s.options.duration,function(){s._trigger("activate",null,s._getEventDate(e));var i=e.attr("aria-load")&&"true"===e.attr("aria-load"),o=e[0].getAttribute("data-type");o&&!i&&s._checkContentType(t(this),o,a),i&&n()})}},_fold:function(e,i,a){var s=this;if(e.jquery){if(s._trigger("beforeFold",null,s._getEventDate(e))===!1)return;if("false"===e.attr("aria-actived"))return;s._isLastHeader(e[0])&&s._fixBottomBorder(!1),s._toggerIcons(t(e)),e.removeClass(s._consts.CLASS.ACTIVE.HEADER).toggleClass(s._consts.CLASS.CORNER+(i?" bottomBorder":"")).attr("aria-actived",!1).next().attr("aria-hidden",!0).slideUp(s.options.duration,function(){s._trigger("fold",null,s._getEventDate(e)),a&&t.isFunction(a)&&a.apply(s,arguments)})}},_fixBottomBorder:function(t){this.headers.last()[t?"addClass":"removeClass"]("bottomBorder")},_isLastHeader:function(t){return t===this.headers.last()[0]},_toggerIcons:function(t){t.find("span.ui-accordion-header-icon:first").toggleClass(this.options.icons.activeHeader+" "+this.options.icons.header)},_checkContentType:function(e,i,a){if(-1===i.indexOf("[")){var s=t("<iframe style = 'width:100%; height:100%' frameborder = 'no'></iframe>"),n=this;e.empty().show().append(s).yhLoading(),s.attr("src",i).on("load",function(){var i=function(){e.animate({height:t.yhui.getDocHeight(s[0].contentWindow.document)},300)};n._delay(i,600),e.prev().attr("aria-load","true"),a&&t.isFunction(a)&&a.apply(this,arguments)===!1||n._trigger("iframeLoaded",null,{header:e.prev(),panel:e})!==!1&&e.yhLoading("destroy")})}else this._ajaxContent(e,i)},_ajaxContent:function(e,i){var a=/^\[(\w+)\](.+)/,s=a.exec(i),n=s[1],o=s[2],r=this;"html"===n?(e.prev().attr("aria-load","true"),e.load(o,function(t){r._trigger("load",null,t)}),e.is(":hidden")&&e.slideDown("fast")):"json"===n&&(e.prev().attr("aria-load","true"),t.getJSON(o,function(t){var i={panel:e,data:t};r._trigger("beforeAppend",null,i)!==!1&&e.append(JSON.stringify(t)),e.is(":hidden")&&e.slideDown("fast")}))},activateAll:function(){var e=this;this.headers.each(function(i){"false"===this.getAttribute("aria-actived")&&e._activate(t(this),i===e.headers.length-1)})},foldAll:function(){var e=this;this.headers.each(function(i){"true"===this.getAttribute("aria-actived")&&e._fold(t(this),i===e.headers.length-1)})},_showHeader:function(t,e,i){var a=this;setTimeout(function(){a.headers.eq(t).show(),e&&a._activate(a.headers.eq(t),a._isLastHeader(a.headers[t]),i)},2)},showHeader:function(e,i,a){var s=this;"number"==typeof e?this._showHeader(e,i,a):t.isArray(e)&&t.each(e,function(t,e){s._showHeader(e,i)})},_hideHeader:function(t,e){var i=this.headers.eq(t);this._fold(i,this._isLastHeader(i[0]),function(){i.hide().next().hide(),e&&i.off().find("a").off().end().remove().next().remove()})},hideHeader:function(e,i){var a=this;"number"==typeof e?this._hideHeader(e,i):t.isArray(e)&&t.each(e,function(t,e){a._hideHeader(e,i)})},activate:function(e,i){var a,s=this;"number"==typeof e?s._activate(s.headers.eq(e),s._isLastHeader(s.headers[e]),i):t.isArray(e)&&t.each(e,function(t,e){a=s.headers.eq(e),s._activate(a,s._isLastHeader(a[0]),i)})},fold:function(e){var i,a=this;"number"==typeof e?a._fold(a.headers.eq(e),a._isLastHeader(a.headers[e])):t.isArray(e)&&t.each(e,function(t,e){i=a.headers.eq(e),a._fold(i,a._isLastHeader(i[0]))})},removeLoading:function(e){t(e).siblings("div.yhui-switch-contentloading").fadeOut("fast",function(){t(this).remove()})}})})(jQuery);